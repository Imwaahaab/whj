<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>لعبة الكذبة والحقيقتين - وهج</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700&display=swap" rel="stylesheet" />
<style>
  /* تصميم متناسق مع وهج */
  body {
    margin: 0;
    background: linear-gradient(135deg, #0a0a0a, #1a1a1a);
    color: #f0f0f0;
    font-family: 'Cairo', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 0 15px 30px;
  }
  header {
    background-color: #0b1a2d;
    width: 100%;
    padding: 15px 30px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header h1 {
    font-size: 28px;
    font-weight: 900;
    margin: 0;
    color: #00bfff;
    text-shadow: 0 0 8px #00bfff;
  }
  header a {
    color: #00bfff;
    font-weight: 700;
    text-decoration: none;
    font-size: 18px;
    border: 2px solid #00bfff;
    padding: 6px 15px;
    border-radius: 10px;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  header a:hover {
    background-color: #00bfff;
    color: #0b1a2d;
  }

  .container {
    background-color: #121212cc;
    padding: 25px 30px;
    border-radius: 16px;
    width: 100%;
    max-width: 600px;
    box-shadow: 0 0 20px #00bfffaa;
    margin-top: 30px;
  }
  input[type="text"], textarea {
    width: 100%;
    background: #222;
    border: none;
    padding: 12px;
    margin: 10px 0 20px 0;
    border-radius: 10px;
    color: #eee;
    font-size: 18px;
    resize: none;
    box-sizing: border-box;
  }
  textarea {
    height: 80px;
  }
  button {
    background-color: #00bfff;
    color: white;
    border: none;
    padding: 14px 25px;
    font-size: 18px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 700;
    box-shadow: 0 0 15px #00bfff;
    transition: background-color 0.3s ease;
  }
  button:hover:not(:disabled) {
    background-color: #009acd;
  }
  button:disabled {
    background-color: #555;
    cursor: not-allowed;
    box-shadow: none;
  }
  .hidden {
    display: none;
  }
  .message {
    font-size: 20px;
    margin-bottom: 15px;
    text-align: center;
  }
  .statement-list button {
    background-color: #222;
    margin: 8px 0;
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: 2px solid transparent;
    color: #eee;
    font-size: 18px;
    cursor: pointer;
    text-align: right;
  }
  .statement-list button:hover {
    border-color: #00bfff;
  }
  .statement-list button.selected {
    border-color: #00bfff;
    background-color: #002a50;
  }
  .results {
    background: #002a50cc;
    border-radius: 14px;
    padding: 20px;
    margin-top: 20px;
  }
  .results h3 {
    margin-top: 0;
    color: #00bfff;
  }
  .results p {
    margin: 8px 0;
  }
</style>
</head>
<body>

<header>
  <h1>وهج</h1>
  <a href="whj.html" title="العودة للرئيسية">الرئيسية</a>
</header>

<div class="container" id="setupScreen">
  <h2>أدخل أسماء اللاعبين</h2>
  <p>أدخل أسماء لاعبين من 2 إلى 6 لاعبين.</p>
  <div id="playerNamesInputs">
    <input type="text" placeholder="اسم اللاعب 1" />
    <input type="text" placeholder="اسم اللاعب 2" />
  </div>
  <button id="addPlayerBtn">➕ أضف لاعب</button>
  <button id="startBtn">ابدأ اللعبة</button>
  <p id="setupError" style="color:#00bfff; font-weight:bold; display:none;"></p>
</div>

<div class="container hidden" id="inputStatementsScreen">
  <h2 id="currentPlayerTitle">لاعب 1: اكتب جملتك</h2>
  <p>اكتب جملتين صحيحتين وجملة واحدة كذبة (غير مرتبة).</p>
  <textarea id="stmt1" placeholder="الجملة الأولى"></textarea>
  <textarea id="stmt2" placeholder="الجملة الثانية"></textarea>
  <textarea id="stmt3" placeholder="الجملة الثالثة (الكذبة)"></textarea>
  <button id="submitStatementsBtn" disabled>حفظ الجمل</button>
  <p id="inputError" style="color:#00bfff; font-weight:bold; display:none;"></p>
</div>

<div class="container hidden" id="playScreen">
  <h2 id="playTitle">جمل اللاعب 1</h2>
  <p>اختر الجملة التي تعتقد أنها الكذبة:</p>
  <div class="statement-list" id="statementsList"></div>
  <button id="confirmVoteBtn" disabled>تأكيد الاختيار</button>
  <p id="voteInfo" style="margin-top:10px; color:#00bfff;"></p>
</div>

<div class="container hidden" id="resultsScreen">
  <h2>النتائج النهائية</h2>
  <div id="resultsContainer"></div>
  <button id="restartBtn" style="margin-top:20px;">إعادة اللعب</button>
</div>

<script>
  // متغيرات اللعب
  let players = [];
  let currentSetupIndex = 0;
  let currentPlayIndex = 0;
  let votes = [];

  // عناصر الشاشة
  const setupScreen = document.getElementById('setupScreen');
  const playerNamesInputs = document.getElementById('playerNamesInputs');
  const addPlayerBtn = document.getElementById('addPlayerBtn');
  const startBtn = document.getElementById('startBtn');
  const setupError = document.getElementById('setupError');

  const inputStatementsScreen = document.getElementById('inputStatementsScreen');
  const currentPlayerTitle = document.getElementById('currentPlayerTitle');
  const stmt1 = document.getElementById('stmt1');
  const stmt2 = document.getElementById('stmt2');
  const stmt3 = document.getElementById('stmt3');
  const submitStatementsBtn = document.getElementById('submitStatementsBtn');
  const inputError = document.getElementById('inputError');

  const playScreen = document.getElementById('playScreen');
  const playTitle = document.getElementById('playTitle');
  const statementsList = document.getElementById('statementsList');
  const confirmVoteBtn = document.getElementById('confirmVoteBtn');
  const voteInfo = document.getElementById('voteInfo');

  const resultsScreen = document.getElementById('resultsScreen');
  const resultsContainer = document.getElementById('resultsContainer');
  const restartBtn = document.getElementById('restartBtn');

  // إضافة لاعب جديد
  addPlayerBtn.onclick = () => {
    if(playerNamesInputs.children.length >= 6) return; // حد أقصى 6 لاعبين
    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = `اسم اللاعب ${playerNamesInputs.children.length + 1}`;
    playerNamesInputs.appendChild(input);
  };

  // تمكين زر الحفظ إذا كانت الحقول كلها مليانة
  function checkStatementsInputs() {
    submitStatementsBtn.disabled = !(stmt1.value.trim() && stmt2.value.trim() && stmt3.value.trim());
  }
  stmt1.addEventListener('input', checkStatementsInputs);
  stmt2.addEventListener('input', checkStatementsInputs);
  stmt3.addEventListener('input', checkStatementsInputs);

  // بدء اللعبة بعد إدخال الأسماء
  startBtn.onclick = () => {
    const inputs = playerNamesInputs.querySelectorAll('input');
    players = [];
    setupError.style.display = 'none';

    for(let inp of inputs){
      const name = inp.value.trim();
      if(!name) {
        setupError.textContent = 'جميع أسماء اللاعبين يجب أن تكون مكتوبة.';
        setupError.style.display = 'block';
        return;
      }
      players.push({
        name: name,
        statements: [],
        lieIndex: 2, // الجملة الثالثة هي الكذبة
        votesGot: 0
      });
    }
    if(players.length < 2){
      setupError.textContent = 'يجب أن يكون هناك لاعبان على الأقل.';
      setupError.style.display = 'block';
      return;
    }

    // إخفاء شاشة الإعداد وفتح شاشة إدخال الجمل لأول لاعب
    setupScreen.classList.add('hidden');
    inputStatementsScreen.classList.remove('hidden');
    currentSetupIndex = 0;
    loadStatementsInput(currentSetupIndex);
  };

  // تحميل شاشة إدخال الجمل للاعب الحالي
  function loadStatementsInput(index){
    currentPlayerTitle.textContent = `لاعب ${index + 1}: ${players[index].name} - اكتب جملك`;
    stmt1.value = '';
    stmt2.value = '';
    stmt3.value = '';
    submitStatementsBtn.disabled = true;
    inputError.style.display = 'none';
  }

  // حفظ جمل اللاعب والتبديل للاعب التالي أو بدء اللعب
  submitStatementsBtn.onclick = () => {
    if(!stmt1.value.trim() || !stmt2.value.trim() || !stmt3.value.trim()){
      inputError.textContent = 'يجب كتابة الثلاث جمل.';
      inputError.style.display = 'block';
      return;
    }
    players[currentSetupIndex].statements = [stmt1.value.trim(), stmt2.value.trim(), stmt3.value.trim()];
    currentSetupIndex++;
    if(currentSetupIndex < players.length){
      loadStatementsInput(currentSetupIndex);
    } else {
      // انتهى جمع الجمل، ابدأ اللعب
      inputStatementsScreen.classList.add('hidden');
      playScreen.classList.remove('hidden');
      currentPlayIndex = 0;
      votes = [];
      loadPlayerStatements(currentPlayIndex);
    }
  };

  // تحميل جمل اللاعب الحالي مع ترتيب عشوائي للجمل
  function loadPlayerStatements(index){
    playTitle.textContent = `جمل اللاعب: ${players[index].name}`;
    statementsList.innerHTML = '';
    confirmVoteBtn.disabled = true;
    voteInfo.textContent = `صوت للاعبين الآخرين لتحديد الجملة التي تعتقد أنها الكذبة.`;

    // رتب الجمل عشوائيًا بحيث لا تكون الكذبة دائمًا ثالث جملة معروضة
    let arr = players[index].statements.map((text, i) => ({text, i}));
    arr = shuffle(arr);

    arr.forEach(item => {
      const btn = document.createElement('button');
      btn.textContent = item.text;
      btn.dataset.index = item.i;
      btn.onclick = () => {
        // إزالة اختيار سابق
        [...statementsList.children].forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        confirmVoteBtn.disabled = false;
      };
      statementsList.appendChild(btn);
    });
  }

  // زر تأكيد التصويت
  confirmVoteBtn.onclick = () => {
    const selectedBtn = statementsList.querySelector('.selected');
    if(!selectedBtn) return;

    const chosenIndex = +selectedBtn.dataset.index;
    // هل الكذبة المختارة؟
    const isLie = (chosenIndex === players[currentPlayIndex].lieIndex);

    votes.push({
      playerName: players[currentPlayIndex].name,
      chosenLieIndex: chosenIndex,
      isLieCorrect: isLie
    });

    currentPlayIndex++;
    if(currentPlayIndex < players.length){
      loadPlayerStatements(currentPlayIndex);
    } else {
      // انتهت الجولة، عرض النتائج
      playScreen.classList.add('hidden');
      showResults();
    }
  };

  // عرض النتائج النهائية
  function showResults(){
    resultsScreen.classList.remove('hidden');
    resultsContainer.innerHTML = '';

    let correctCount = 0;

    votes.forEach(vote => {
      const p = document.createElement('p');
      p.textContent = `${vote.playerName} اختار ${vote.isLieCorrect ? 'الكذبة صحيحة' : 'خطأ في الكذبة'}`;
      p.style.color = vote.isLieCorrect ? '#00ff00' : '#ff5555';
      resultsContainer.appendChild(p);
      if(vote.isLieCorrect) correctCount++;
    });

    const summary = document.createElement('h3');
    summary.textContent = `عدد التخمينات الصحيحة: ${correctCount} من ${votes.length}`;
    resultsContainer.prepend(summary);
  }

  // إعادة تشغيل اللعبة
  restartBtn.onclick = () => {
    resultsScreen.classList.add('hidden');
    setupScreen.classList.remove('hidden');
    // تنظيف الإدخالات
    const inputs = playerNamesInputs.querySelectorAll('input');
    inputs.forEach(inp => inp.value = '');
  };

  // دالة shuffle لترتيب عشوائي
  function shuffle(array) {
    let currentIndex = array.length, randomIndex;

    while (currentIndex != 0) {
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex--;

      [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
    }

    return array;
  }
</script>

</body>
</html>
