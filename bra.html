<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù„Ø¹Ø¨Ø© Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ© - ÙˆÙ‡Ø¬</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700;900&display=swap" rel="stylesheet" />
<style>
  body {
    margin: 0; 
    background-color: #0f1c2e; 
    color: #fff; 
    font-family: 'Cairo', sans-serif; 
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  header {
    width: 100%;
    background-color: #0b1a2d; 
    padding: 15px 30px; 
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    font-size: 24px;
    font-weight: 900;
    color: #00bfff;
    text-align: center;
    margin-bottom: 30px;
  }
  .container {
    background: #13294b;
    border-radius: 14px;
    padding: 30px 40px;
    max-width: 600px;
    width: 100%;
    box-shadow: 0 0 15px rgba(0,0,0,0.25);
    text-align: center;
  }
  h2 {
    margin-top: 0;
    color: #00bfff;
    font-weight: 900;
    margin-bottom: 20px;
  }
  label {
    display: block;
    margin: 15px 0 8px;
    font-weight: 700;
    text-align: right;
  }
  select, input[type="text"] {
    width: 100%;
    padding: 10px 12px;
    font-size: 18px;
    border-radius: 8px;
    border: none;
    box-sizing: border-box;
    text-align: right;
  }
  button {
    background-color: #00bfff;
    color: white;
    border: none;
    padding: 14px 20px;
    font-size: 18px;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 25px;
    width: 100%;
    font-weight: 700;
    transition: background-color 0.3s ease;
  }
  button:hover:not(:disabled) {
    background-color: #009acd;
  }
  button:disabled {
    background-color: #555;
    cursor: not-allowed;
  }
  #messageBox {
    margin-top: 20px;
    font-weight: 700;
    font-size: 18px;
    min-height: 48px;
    color: #ff6666;
  }
  .hidden {
    display: none;
  }
  #currentTurn {
    font-size: 22px;
    font-weight: 900;
    margin-bottom: 20px;
    color: #00ff88;
  }
  #questionsList {
    max-height: 180px;
    overflow-y: auto;
    background: #0b1a2d;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    text-align: right;
  }
  #questionsList div {
    margin-bottom: 10px;
    font-size: 17px;
  }
  #playersVoteList button {
    width: 100%;
    margin: 5px 0;
    font-size: 18px;
    border-radius: 10px;
    padding: 10px;
    background-color: #1d3c5f;
    color: white;
    border: none;
    cursor: pointer;
  }
  #playersVoteList button:disabled {
    background-color: #555;
    cursor: not-allowed;
  }
  #customAskSection label {
    margin-top: 15px;
  }
</style>
</head>
<body>

<header>Ù„Ø¹Ø¨Ø© Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ© - ÙˆÙ‡Ø¬</header>

<div class="container" id="setupScreen">
  <h2>Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¶ÙˆØ¹ ÙˆÙ„Ø¹Ø¨ Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h2>
  <label for="topicSelect">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</label>
  <select id="topicSelect">
    <option value="">-- Ø§Ø®ØªØ± Ù…ÙˆØ¶ÙˆØ¹ --</option>
    <option value="Ø­ÙŠÙˆØ§Ù†Ø§Øª">Ø­ÙŠÙˆØ§Ù†Ø§Øª</option>
    <option value="ÙÙˆØ§ÙƒÙ‡">ÙÙˆØ§ÙƒÙ‡</option>
    <option value="Ù…Ø´Ø§Ù‡ÙŠØ±">Ù…Ø´Ø§Ù‡ÙŠØ±</option>
    <option value="Ø£ÙƒÙ„Ø§Øª">Ø£ÙƒÙ„Ø§Øª</option>
    <option value="Ù…Ø¯Ù†">Ù…Ø¯Ù†</option>
  </select>

  <label>Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (3 Ø¥Ù„Ù‰ 10):</label>
  <div id="playersInputs">
    <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 1" />
    <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 2" />
    <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 3" />
  </div>
  <button id="addPlayerBtn">â• Ø£Ø¶Ù Ù„Ø§Ø¹Ø¨</button>
  <button id="startGameBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
  <div id="messageBox"></div>
</div>

<div class="container hidden" id="roleRevealScreen">
  <h2>ÙƒØ´Ù Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</h2>
  <div id="currentTurn"></div>
  <div id="wordReveal"></div>
  <button id="nextRevealBtn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
</div>

<div class="container hidden" id="questionScreen">
  <h2>Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
  <div id="currentTurnQuestion"></div>
  
  <div id="questionsList"></div>

  <div id="customAskSection" class="hidden">
    <label for="customAskerSelect">Ø§Ø®ØªØ± Ù…Ù† ÙŠØ³Ø£Ù„:</label>
    <select id="customAskerSelect"></select>

    <label for="customTargetSelect">Ø§Ø®ØªØ± Ù…Ù† ÙŠÙØ³Ø£Ù„:</label>
    <select id="customTargetSelect"></select>

    <button id="customAskBtn">Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</button>
  </div>
  
  <button id="nextQuestionBtn" disabled>Ø§Ù„ØªØ§Ù„ÙŠ</button>
  <button id="startVoteBtn" class="hidden">Ø¨Ø¯Ø¡ Ø§Ù„ØªØµÙˆÙŠØª</button>
</div>

<div class="container hidden" id="voteScreen">
  <h2>Ø§Ù„ØªØµÙˆÙŠØª Ø¹Ù„Ù‰ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©</h2>
  <div id="voteInstructions">ØµÙˆØª Ù…Ù† ØªØ¹ØªÙ‚Ø¯ Ø£Ù†Ù‡ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©</div>
  <div id="playersVoteList"></div>
  <button id="finishVoteBtn" disabled>Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØµÙˆÙŠØª</button>
</div>

<div class="container hidden" id="resultScreen">
  <h2>Ø§Ù„Ù†ØªÙŠØ¬Ø©</h2>
  <div id="resultMessage" style="font-size:20px; font-weight:900; text-align:center; margin-bottom: 20px;"></div>
  <button id="restartBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
</div>

<script>
  const topicsWords = {
    "Ø­ÙŠÙˆØ§Ù†Ø§Øª": [
      "ÙÙŠÙ„", "Ø£Ø³Ø¯", "Ø²Ø±Ø§ÙØ©", "Ù†Ù…Ø±", "ÙÙ‡Ø¯", "ÙƒÙ†ØºØ±", "ØªÙ…Ø³Ø§Ø­", "ØºØ²Ø§Ù„", "Ø°Ø¦Ø¨", "Ø¯Ø¨",
      "Ø«Ø¹Ù„Ø¨", "Ø¨Ø·Ø±ÙŠÙ‚", "Ø³Ù…ÙƒØ© Ù‚Ø±Ø´", "Ø¨Ø¨ØºØ§Ø¡", "Ù†Ø¹Ø§Ù…Ø©", "Ø­ØµØ§Ù†", "Ø³Ù„Ø­ÙØ§Ø©", "Ù‚Ø±Ø´", "ÙÙ‡Ø¯", "Ù†Ø³Ø±"
    ],
    "ÙÙˆØ§ÙƒÙ‡": [
      "ØªÙØ§Ø­", "Ù…ÙˆØ²", "Ø¨Ø±ØªÙ‚Ø§Ù„", "Ø¹Ù†Ø¨", "Ø®ÙˆØ®", "Ø±Ù…Ø§Ù†", "ÙØ±Ø§ÙˆÙ„Ø©", "Ø£Ù†Ø§Ù†Ø§Ø³", "ÙƒÙŠÙˆÙŠ", "Ù…Ø§Ù†Ø¬Ùˆ",
      "ÙƒÙ…Ø«Ø±Ù‰", "Ø¬ÙˆØ§ÙØ©", "ØªÙŠÙ†", "Ù„ÙŠÙ…ÙˆÙ†", "ÙƒØ±Ø²", "Ø¨Ø§Ø¨Ø§ÙŠØ§", "Ø¨Ø·ÙŠØ®", "Ø¯Ø±Ø§Ù‚", "ÙƒØ´Ù…Ø´", "Ù…Ø´Ù…Ø´"
    ],
    "Ù…Ø´Ø§Ù‡ÙŠØ±": [
      "Ø£Ø­Ù…Ø¯", "Ù…Ø­Ù…Ø¯", "Ø³Ù„Ù…Ø§Ù†", "Ø¹Ù„ÙŠ", "Ø®Ø§Ù„Ø¯", "ÙØ§Ø·Ù…Ø©", "Ø³Ø§Ø±Ø©", "Ø±ÙŠÙ…", "Ù‡Ù†Ø¯", "Ù†ÙˆØ±Ø©",
      "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡", "ÙŠÙˆØ³Ù", "Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ", "Ø¹Ø§Ø¦Ø´Ø©", "Ø®Ø¯ÙŠØ¬Ø©", "Ù‡Ø§Ù†ÙŠ", "Ø±Ù†Ø§", "Ø³Ù…ÙŠØ±", "Ù…Ù‡Ø§", "Ù…Ù†Ù‰"
    ],
    "Ø£ÙƒÙ„Ø§Øª": [
      "ÙƒØ¨Ø³Ø©", "Ø¨Ø±Ø¬Ø±", "Ø¨ÙŠØªØ²Ø§", "Ø´Ø§ÙˆØ±Ù…Ø§", "Ù…Ø¹ÙƒØ±ÙˆÙ†Ø©", "Ø³Ù„Ø·Ø©", "Ø­Ù…Øµ", "ÙÙ„Ø§ÙÙ„", "ÙƒØ¨Ø§Ø¨", "Ù…Ù†Ø¯ÙŠ",
      "Ø¨Ø·Ø§Ø·Ø§ Ù…Ù‚Ù„ÙŠØ©", "Ø´ÙˆØ±Ø¨Ø©", "Ø³Ù…Ùƒ", "Ø¯Ø¬Ø§Ø¬ Ù…Ø´ÙˆÙŠ", "ÙƒÙ†Ø§ÙØ©", "Ø¨Ù‚Ù„Ø§ÙˆØ©", "Ø´ÙˆØ±Ø¨Ø© Ø¹Ø¯Ø³", "Ø´ÙŠØ´ Ø·Ø§ÙˆÙˆÙ‚", "ÙˆØ±Ù‚ Ø¹Ù†Ø¨", "Ù…Ø­Ø´ÙŠ"
    ],
    "Ù…Ø¯Ù†": [
      "Ø§Ù„Ø±ÙŠØ§Ø¶", "Ø¬Ø¯Ø©", "Ø¯Ø¨ÙŠ", "Ø§Ù„Ø¯ÙˆØ­Ø©", "Ø£Ø¨ÙˆØ¸Ø¨ÙŠ", "Ø§Ù„ÙƒÙˆÙŠØª", "Ù…Ø³Ù‚Ø·", "Ø¨ÙŠØ±ÙˆØª", "Ø¯Ù…Ø´Ù‚", "Ø¨ØºØ¯Ø§Ø¯",
      "Ø·Ø±Ø§Ø¨Ù„Ø³", "Ø§Ù„Ù…Ù†Ø§Ù…Ø©", "Ø§Ù„Ù‚Ø¯Ø³", "ØµÙ†Ø¹Ø§Ø¡", "Ø¹Ø¯Ù†", "Ø­ÙŠÙØ§", "Ø§Ù„Ø®Ø±Ø·ÙˆÙ…", "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±", "ØªÙˆÙ†Ø³", "Ø§Ù„Ø±Ø¨Ø§Ø·"
    ]
  };

  const minPlayers = 3;
  const maxPlayers = 10;

  // Ø¹Ù†Ø§ØµØ± DOM
  const setupScreen = document.getElementById('setupScreen');
  const topicSelect = document.getElementById('topicSelect');
  const playersInputs = document.getElementById('playersInputs');
  const addPlayerBtn = document.getElementById('addPlayerBtn');
  const startGameBtn = document.getElementById('startGameBtn');
  const messageBox = document.getElementById('messageBox');

  const roleRevealScreen = document.getElementById('roleRevealScreen');
  const currentTurn = document.getElementById('currentTurn');
  const wordReveal = document.getElementById('wordReveal');
  const nextRevealBtn = document.getElementById('nextRevealBtn');

  const questionScreen = document.getElementById('questionScreen');
  const currentTurnQuestion = document.getElementById('currentTurnQuestion');
  const questionsList = document.getElementById('questionsList');
  const nextQuestionBtn = document.getElementById('nextQuestionBtn');
  const customAskSection = document.getElementById('customAskSection');
  const customAskerSelect = document.getElementById('customAskerSelect');
  const customTargetSelect = document.getElementById('customTargetSelect');
  const customAskBtn = document.getElementById('customAskBtn');
  const startVoteBtn = document.getElementById('startVoteBtn');

  const voteScreen = document.getElementById('voteScreen');
  const playersVoteList = document.getElementById('playersVoteList');
  const finishVoteBtn = document.getElementById('finishVoteBtn');

  const resultScreen = document.getElementById('resultScreen');
  const resultMessage = document.getElementById('resultMessage');
  const restartBtn = document.getElementById('restartBtn');

  // Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
  let players = [];
  let currentPlayerIndex = 0;
  let currentPhase = 'setup'; // Ù…Ø±Ø§Ø­Ù„: setup, revealRoles, questions, voting, result
  let chosenTopic = '';
  let secretWord = '';
  let liarIndex = -1;
  let questionsAsked = [];
  const maxQuestions = 5;
  let questionCount = 0;
  let selectedVoteIndex = null;

  // Ø®Ù„Ø· Ø¹Ù†Ø§ØµØ± Ù…ØµÙÙˆÙØ©
  function shuffle(arr) {
    let array = arr.slice();
    for (let i = array.length -1; i > 0; i--) {
      let j = Math.floor(Math.random()*(i+1));
      [array[i],array[j]] = [array[j],array[i]];
    }
    return array;
  }

  // Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯
  addPlayerBtn.onclick = () => {
    if (playersInputs.children.length >= maxPlayers) return;
    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = `Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ${playersInputs.children.length + 1}`;
    playersInputs.appendChild(input);
  };

  // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
  startGameBtn.onclick = () => {
    messageBox.textContent = '';
    chosenTopic = topicSelect.value;
    if (!chosenTopic) {
      messageBox.textContent = 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¶ÙˆØ¹ Ù„Ù„Ø¹Ø¨';
      return;
    }
    const inputs = playersInputs.querySelectorAll('input');
    const names = [];
    for (let inp of inputs) {
      if (inp.value.trim() === '') {
        messageBox.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†';
        return;
      }
      names.push(inp.value.trim());
    }
    if (names.length < minPlayers || names.length > maxPlayers) {
      messageBox.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† ${minPlayers} Ùˆ ${maxPlayers}`;
      return;
    }
    players = names.map(name => ({name, isOut:false}));
    startRevealRoles();
  };

  // ÙƒØ´Ù Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
  function startRevealRoles() {
    setupScreen.classList.add('hidden');
    roleRevealScreen.classList.remove('hidden');
    currentPlayerIndex = 0;
    secretWord = shuffle(topicsWords[chosenTopic])[0];
    liarIndex = Math.floor(Math.random() * players.length);
    currentPhase = 'revealRoles';
    showNextRole();
  }

  function showNextRole() {
    if (currentPlayerIndex >= players.length) {
      currentPhase = 'questions';
      currentPlayerIndex = 0;
      roleRevealScreen.classList.add('hidden');
      startQuestionsRound();
      return;
    }
    currentTurn.textContent = `Ø¹Ø· Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ù€ ${players[currentPlayerIndex].name}`;
    if (currentPlayerIndex === liarIndex) {
      wordReveal.textContent = `Ø£Ù†Øª Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©! Ù„Ø§ ØªØ¹Ø±Ù Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ÙŠØ©.`;
    } else {
      wordReveal.textContent = `ÙƒÙ„Ù…ØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ© Ù‡ÙŠ: ${secretWord}`;
    }
  }

  nextRevealBtn.onclick = () => {
    currentPlayerIndex++;
    showNextRole();
  };

  // Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
  function startQuestionsRound() {
    questionScreen.classList.remove('hidden');
    questionCount = 0;
    questionsAsked = [];
    currentPlayerIndex = 0;
    currentPhase = 'questions';
    updateQuestionTurn();
    renderQuestions();
    nextQuestionBtn.disabled = false;
    startVoteBtn.classList.add('hidden');
    customAskSection.classList.add('hidden');
  }

  function updateQuestionTurn() {
    const asker = players[currentPlayerIndex].name;
    let targetIndex = currentPlayerIndex;
    // Ù†Ø®ØªØ§Ø± Ù„Ø§Ø¹Ø¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ ØºÙŠØ± Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ³Ø£Ù„
    while(targetIndex === currentPlayerIndex) {
      targetIndex = Math.floor(Math.random() * players.length);
    }
    const target = players[targetIndex].name;

    currentTurnQuestion.textContent = `${asker} ÙŠØ³Ø£Ù„ ${target}`;
  }

  function renderQuestions() {
    questionsList.innerHTML = '';
    questionsAsked.forEach(q => {
      const askerName = players[q.asker].name;
      const targetName = players[q.target].name;
      const div = document.createElement('div');
      div.textContent = `${askerName} Ø³Ø£Ù„ ${targetName}`;
      questionsList.appendChild(div);
    });
  }

  nextQuestionBtn.onclick = () => {
    // Ù†Ø³Ø¬Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ø¹ Ù…Ù† Ø·Ø±Ø­ ÙˆÙ…Ù† Ø£Ø¬Ø§Ø¨
    const asker = currentPlayerIndex;
    let targetIndex = currentPlayerIndex;
    while(targetIndex === currentPlayerIndex) {
      targetIndex = Math.floor(Math.random() * players.length);
    }
    questionsAsked.push({asker, target: targetIndex});
    questionCount++;

    if(questionCount >= maxQuestions) {
      // Ù†Ø·Ù„Ø¹ Ù…Ù† Ø¯ÙˆØ± Ø§Ù„Ø§Ø³Ø¦Ù„Ø© Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ÙŠØ®ØªØ§Ø± Ù…Ù† Ø¨ÙŠØ³Ø£Ù„ Ø¹Ø´Ø§Ù† Ø§Ù„ØªÙ†ÙˆÙŠØ¹
      nextQuestionBtn.disabled = true;
      customAskSection.classList.remove('hidden');
      startVoteBtn.classList.remove('hidden');
      currentTurnQuestion.textContent = `Ø§Ø®ØªØ§Ø± Ù…Ù† Ø¨ÙŠØ³Ø£Ù„ ÙˆÙ…Ù† ÙŠÙØ³Ø£Ù„ Ø«Ù… Ø§Ø¶ØºØ· Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Ø¨Ø¯Ø¡ Ø§Ù„ØªØµÙˆÙŠØª`;
      populateCustomSelects();
      return;
    }

    currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    updateQuestionTurn();
    renderQuestions();
  };

  // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
  function populateCustomSelects() {
    customAskerSelect.innerHTML = '';
    customTargetSelect.innerHTML = '';
    players.forEach((p, i) => {
      if(!p.isOut) {
        let option = document.createElement('option');
        option.value = i;
        option.textContent = p.name;
        customAskerSelect.appendChild(option);

        // Ù†Ø³Ø® Ù„Ù„ØªØ§Ù†ÙŠ Ø¨Ø³ Ù„Ø§Ø²Ù… Ù†Ù…Ù†Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙØ³ Ø§Ù„Ø´Ø®ØµÙŠÙ†
        option = document.createElement('option');
        option.value = i;
        option.textContent = p.name;
        customTargetSelect.appendChild(option);
      }
    });
    customAskerSelect.selectedIndex = 0;
    customTargetSelect.selectedIndex = 1 >= players.length ? 0 : 1;
    validateCustomAskBtn();
  }

  // Ù…Ù†Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙÙŠ Ø§Ù„Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„Ù…ÙØ³Ø£Ù„
  customAskerSelect.onchange = () => {
    if(customAskerSelect.value === customTargetSelect.value) {
      // Ù†ØºÙŠØ± Ø§Ù„Ù‡Ø¯Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
      let newIndex = (parseInt(customTargetSelect.value) + 1) % players.length;
      if(newIndex === parseInt(customAskerSelect.value)) newIndex = (newIndex + 1) % players.length;
      customTargetSelect.value = newIndex;
    }
    validateCustomAskBtn();
  };
  customTargetSelect.onchange = () => {
    if(customAskerSelect.value === customTargetSelect.value) {
      let newIndex = (parseInt(customAskerSelect.value) + 1) % players.length;
      if(newIndex === parseInt(customTargetSelect.value)) newIndex = (newIndex + 1) % players.length;
      customAskerSelect.value = newIndex;
    }
    validateCustomAskBtn();
  };

  // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ØµØ­ÙŠØ­
  function validateCustomAskBtn() {
    customAskBtn.disabled = (customAskerSelect.value === customTargetSelect.value);
  }

  // Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠØ¯ÙˆÙŠ
  customAskBtn.onclick = () => {
    const asker = parseInt(customAskerSelect.value);
    const target = parseInt(customTargetSelect.value);
    questionsAsked.push({asker, target});
    questionCount++;

    renderQuestions();

    if(questionCount >= maxQuestions + 3) {
      // Ø¨Ø¹Ø¯ ÙƒÙ… Ø³Ø¤Ø§Ù„ Ø²ÙŠØ§Ø¯Ø© Ù†Ø®ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
      customAskSection.classList.add('hidden');
      startVoteBtn.classList.remove('hidden');
      nextQuestionBtn.disabled = true;
      currentTurnQuestion.textContent = `ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¨Ø¯Ø¡ Ø§Ù„ØªØµÙˆÙŠØª`;
    } else {
      currentTurnQuestion.textContent = `${players[asker].name} ÙŠØ³Ø£Ù„ ${players[target].name}`;
    }
    validateCustomAskBtn();
  };

  // Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„ØªØµÙˆÙŠØª Ù…Ù† Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
  startVoteBtn.onclick = () => {
    questionScreen.classList.add('hidden');
    startVotingRound();
  };

  // Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØµÙˆÙŠØª
  function startVotingRound() {
    voteScreen.classList.remove('hidden');
    renderVotePlayers();
    finishVoteBtn.disabled = true;
    currentPhase = 'voting';
    selectedVoteIndex = null;
  }

  // Ø¹Ø±Ø¶ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„ØªØµÙˆÙŠØª
  function renderVotePlayers() {
    playersVoteList.innerHTML = '';
    players.forEach((p,i) => {
      if(!p.isOut) {
        const btn = document.createElement('button');
        btn.textContent = p.name;
        btn.dataset.index = i;
        btn.addEventListener('click', () => voteSelected(i));
        playersVoteList.appendChild(btn);
      }
    });
  }

  // Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨ Ù„Ù„ØªØµÙˆÙŠØª
  function voteSelected(index) {
    selectedVoteIndex = index;
    [...playersVoteList.children].forEach(btn => {
      btn.disabled = btn.dataset.index != index;
    });
    finishVoteBtn.disabled = false;
  }

  // Ø§Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØµÙˆÙŠØª ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
  finishVoteBtn.onclick = () => {
    if(selectedVoteIndex === null) return;
    voteScreen.classList.add('hidden');
    resultScreen.classList.remove('hidden');

    if(selectedVoteIndex === liarIndex) {
      resultMessage.textContent = `ØµØ§Ø¯ÙˆØ§ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©! Ø§Ù„Ù„Ø§Ø¹Ø¨ "${players[liarIndex].name}" Ù‡Ùˆ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©. ÙØ§Ø² Ø§Ù„Ø¬Ù…ÙŠØ¹! ğŸ‰`;
    } else {
      resultMessage.textContent = `Ù„Ù… ÙŠØµØ§Ø¯ÙˆØ§ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©. Ø§Ù„Ù„Ø§Ø¹Ø¨ "${players[liarIndex].name}" Ù‡Ùˆ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ© ÙˆÙØ§Ø² Ù‡Ùˆ! ğŸ˜¢`;
    }
  };

  // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨
  restartBtn.onclick = () => {
    players = [];
    currentPlayerIndex = 0;
    currentPhase = 'setup';
    chosenTopic = '';
    secretWord = '';
    liarIndex = -1;
    questionsAsked = [];
    selectedVoteIndex = null;
    messageBox.textContent = '';
    topicSelect.value = '';
    playersInputs.innerHTML = '';
    for(let i=0; i<3; i++){
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = `Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ${i+1}`;
      playersInputs.appendChild(input);
    }

    setupScreen.classList.remove('hidden');
    roleRevealScreen.classList.add('hidden');
    questionScreen.classList.add('hidden');
    voteScreen.classList.add('hidden');
    resultScreen.classList.add('hidden');
    nextQuestionBtn.disabled = false;
    startVoteBtn.classList.add('hidden');
    customAskSection.classList.add('hidden');
  };
</script>

</body>
</html>
